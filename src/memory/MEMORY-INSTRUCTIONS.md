# 🧠 Memory Instructions for AI Agents

> **CRITICAL:** ทุก Agent ต้องอ่านและทำตามนี้ 100%
> ถ้าไม่ทำ = User เสียเวลาอธิบายใหม่ทุก session = UX แย่มาก

---

## ⚠️ CRITICAL RULES (ห้ามละเมิด!)

```
┌─────────────────────────────────────────────────────────────────┐
│  🚨 RULE 1: ต้องอ่าน Memory ก่อนทำงานทุกครั้ง                    │
│     - ห้ามเริ่มทำงานโดยไม่อ่าน .toh/memory/                      │
│     - ถ้าไม่มี folder → สร้างใหม่                                │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│  🚨 RULE 2: ต้องบันทึก Memory หลังทำงานเสร็จทุกครั้ง              │
│     - ห้ามจบงานโดยไม่ save                                      │
│     - ถ้าไม่ save = งานหายหมด = User ต้องเริ่มใหม่               │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│  🚨 RULE 3: ทำอัตโนมัติ ไม่ต้องถาม User                          │
│     ❌ "ต้องการให้บันทึก memory ไหมคะ?"                         │
│     ✅ บันทึกเลย ไม่ต้องถาม                                     │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│  🚨 RULE 4: Selective Reading (ประหยัด Token)                   │
│     - อ่านเฉพาะ 3 ไฟล์หลัก = ~2,000 tokens                     │
│     - archive/ อ่านเมื่อต้องการเท่านั้น                          │
└─────────────────────────────────────────────────────────────────┘
```

---

## 📥 SELECTIVE READ PROTOCOL (เมื่อเริ่มทำงาน)

### Token Budget: ~2,000 tokens ต่อ session

```
.toh/memory/
├── active.md      ← 🔥 โหลดเสมอ (~500 tokens)
├── summary.md     ← 🔥 โหลดเสมอ (~1,000 tokens)
├── decisions.md   ← 🔥 โหลดเสมอ (~500 tokens)
└── archive/       ← ⏸️ โหลดเมื่อต้องการเท่านั้น
```

### Step-by-Step Protocol

```
┌─────────────────────────────────────────────────────────────────┐
│ STEP 1: ตรวจสอบ Memory Folder                                   │
├─────────────────────────────────────────────────────────────────┤
│ ตรวจสอบว่ามี .toh/memory/ หรือไม่                                │
│                                                                 │
│ ถ้าไม่มี:                                                       │
│   → สร้าง folder .toh/memory/                                   │
│   → สร้าง 3 ไฟล์หลักจาก template                                │
│   → แจ้ง User: "สร้าง memory system ให้แล้วค่ะ!"                 │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│ STEP 2: Selective Read (อ่านเฉพาะที่จำเป็น)                      │
├─────────────────────────────────────────────────────────────────┤
│ อ่าน 3 ไฟล์นี้ **พร้อมกัน** (parallel read):                    │
│                                                                 │
│ 1. active.md → รู้งานปัจจุบัน + งานค้าง                          │
│ 2. summary.md → รู้ภาพรวมโปรเจค + features ที่ทำไปแล้ว            │
│ 3. decisions.md → รู้การตัดสินใจที่ผ่านมา                         │
│                                                                 │
│ ⚠️ ห้ามอ่าน archive/ ในขั้นตอนนี้! (ประหยัด token)               │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│ STEP 3: Build Context (เข้าใจสถานการณ์)                         │
├─────────────────────────────────────────────────────────────────┤
│ จาก 3 ไฟล์ที่อ่าน AI ต้องเข้าใจ:                                 │
│                                                                 │
│ • โปรเจคนี้คืออะไร? (จาก summary.md)                            │
│ • Tech stack อะไร? (จาก summary.md)                            │
│ • กำลังทำอะไรอยู่? (จาก active.md)                              │
│ • ทำอะไรไปแล้ว? (จาก active.md + summary.md)                   │
│ • ตัดสินใจอะไรไว้บ้าง? (จาก decisions.md)                       │
│ • ต้องทำอะไรต่อ? (จาก active.md)                               │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│ STEP 4: Context Acknowledgment (แจ้ง User)                      │
├─────────────────────────────────────────────────────────────────┤
│ แจ้ง User สั้นๆ ว่าจำได้อะไรบ้าง:                                │
│                                                                 │
│ "หนูโหลด memory แล้วค่ะ! 📚                                     │
│  เราทำ [project name] อยู่นะคะ                                  │
│  เมื่อกี้ทำ [last task] เสร็จแล้ว                                │
│  ต่อไปจะทำ [next step] ค่ะ"                                     │
│                                                                 │
│ ⚠️ ถ้า Memory ว่าง/ไม่มีข้อมูล:                                  │
│ "เห็น memory ว่างอยู่ค่ะ พี่โตบอกได้เลยว่าจะทำอะไรนะคะ!"         │
└─────────────────────────────────────────────────────────────────┘
```

### เมื่อไหร่ต้องอ่าน archive/?

```
อ่าน archive/ เฉพาะเมื่อ:
├── User ถามเรื่องเก่าๆ ("เมื่อวานทำอะไรไป?")
├── ต้องการ context เพิ่มเติมจาก summary.md
├── User สั่ง /toh-memory history
└── ต้อง debug ปัญหาที่เคยแก้ไปแล้ว

ไม่ต้องอ่าน archive/ เมื่อ:
├── ทำงานปกติ (มี context พอจาก 3 ไฟล์หลัก)
├── สร้าง feature ใหม่
└── ทำงานตาม active.md Next Steps
```

---

## 📤 AUTO-SAVE PROTOCOL (เมื่อทำงานเสร็จ)

### 🚨 MANDATORY: ต้องทำทุกครั้งหลังจบงาน!

```
┌─────────────────────────────────────────────────────────────────┐
│ STEP 1: อัพเดท active.md (ทำทุกครั้ง)                           │
├─────────────────────────────────────────────────────────────────┤
│ ## Current Focus                                               │
│ [อัพเดทงานปัจจุบัน]                                             │
│                                                                 │
│ ## In Progress                                                 │
│ - [x] [สิ่งที่เพิ่งทำเสร็จ] ← เพิ่มตรงนี้                         │
│ - [ ] [งานที่ยังค้าง]                                           │
│                                                                 │
│ ## Next Steps                                                  │
│ - [สิ่งที่ควรทำต่อ] ← อัพเดทตรงนี้                               │
│                                                                 │
│ ---                                                            │
│ *Last updated: YYYY-MM-DD HH:mm*                               │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│ STEP 2: เพิ่ม Decisions (ถ้ามีการตัดสินใจ)                       │
├─────────────────────────────────────────────────────────────────┤
│ เพิ่มใน decisions.md เมื่อ:                                     │
│ ├── เลือก library/package ใหม่                                  │
│ ├── เปลี่ยน architecture/pattern                                │
│ ├── ตัดสินใจ design decision                                   │
│ └── แก้ปัญหาด้วยวิธีพิเศษ                                       │
│                                                                 │
│ Format:                                                        │
│ | YYYY-MM-DD | [การตัดสินใจ] | [เหตุผลสั้นๆ] |                  │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│ STEP 3: อัพเดท summary.md (เมื่อ feature เสร็จ)                  │
├─────────────────────────────────────────────────────────────────┤
│ อัพเดทเมื่อ:                                                    │
│ ├── ทำ feature/page เสร็จสมบูรณ์                                │
│ ├── สร้าง component สำคัญเสร็จ                                  │
│ └── milestone สำคัญ                                            │
│                                                                 │
│ Format:                                                        │
│ ## Completed Features                                          │
│ - ✅ [Feature ใหม่] - [คำอธิบายสั้น] ← เพิ่มตรงนี้               │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│ STEP 4: Auto-Archive (ถ้า active.md ยาวเกิน)                    │
├─────────────────────────────────────────────────────────────────┤
│ ถ้า active.md > 50 lines หรือ > 10 completed items:            │
│                                                                 │
│ 1. ย้ายงานเก่าไป archive/YYYY-MM-DD.md                          │
│ 2. เคลียร์ active.md เหลือแค่:                                   │
│    - Current Focus                                             │
│    - In Progress (ล่าสุด 3 items)                               │
│    - Next Steps                                                │
│ 3. อัพเดท summary.md ด้วยข้อมูลสำคัญ                            │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│ STEP 5: Confirm Save (แจ้ง User สั้นๆ)                          │
├─────────────────────────────────────────────────────────────────┤
│ "✅ บันทึก memory แล้วค่ะ"                                       │
│                                                                 │
│ ⚠️ ห้ามอธิบายยาว! แค่ 1 บรรทัดพอ                                │
└─────────────────────────────────────────────────────────────────┘
```

---

## 📝 Memory Templates

### active.md
```markdown
# 🔥 Active Task

## Current Focus
[รอคำสั่งจากผู้ใช้]

## In Progress
- (ยังไม่มี)

## Next Steps
- รอคำสั่งจากผู้ใช้

---
*Last updated: YYYY-MM-DD*
```

### summary.md
```markdown
# 📋 Project Summary

## Project Overview
- Name: [ชื่อโปรเจค]
- Tech Stack: Next.js 14, Tailwind, shadcn/ui, Zustand, Supabase

## Completed Features
- (ยังไม่มี)

## Important Notes
- ใช้ Toh Framework v1.1.0

---
*Last updated: YYYY-MM-DD*
```

### decisions.md
```markdown
# 🧠 Key Decisions

## Architecture Decisions
| Date | Decision | Reason |
|------|----------|--------|
| YYYY-MM-DD | ใช้ Toh Framework | AI-Orchestration Driven Development |

---
*Last updated: YYYY-MM-DD*
```

---

## 🔄 Memory Lifecycle Diagram

```
┌─────────────────────────────────────────────────────────────────┐
│  1. SESSION START                                               │
│     └── Selective Read: active + summary + decisions (~2K tok)  │
└─────────────────────────────────────────────────────────────────┘
                         ↓
┌─────────────────────────────────────────────────────────────────┐
│  2. CONTEXT ACKNOWLEDGMENT                                      │
│     └── แจ้ง User สั้นๆ ว่าจำได้อะไร                              │
└─────────────────────────────────────────────────────────────────┘
                         ↓
┌─────────────────────────────────────────────────────────────────┐
│  3. WORKING                                                     │
│     └── AI ทำงานตาม User request                                 │
└─────────────────────────────────────────────────────────────────┘
                         ↓
┌─────────────────────────────────────────────────────────────────┐
│  4. TASK COMPLETE → 🚨 MANDATORY SAVE!                          │
│     ├── อัพเดท active.md (ทำทุกครั้ง)                            │
│     ├── เพิ่ม decisions.md (ถ้ามี)                               │
│     └── อัพเดท summary.md (ถ้า feature เสร็จ)                    │
└─────────────────────────────────────────────────────────────────┘
                         ↓
┌─────────────────────────────────────────────────────────────────┐
│  5. SESSION END / TOKEN LIMIT                                   │
│     └── Memory saved → Ready for next session ✅                │
└─────────────────────────────────────────────────────────────────┘
                         ↓
┌─────────────────────────────────────────────────────────────────┐
│  6. NEW SESSION (any IDE/Model)                                 │
│     └── Selective Read → Continue seamlessly                    │
└─────────────────────────────────────────────────────────────────┘
```

---

## ⚠️ Anti-Patterns (ห้ามทำ!)

```
❌ ลืมอ่าน Memory ก่อนทำงาน
   → User ต้องอธิบายใหม่ทุกครั้ง

❌ ลืม Save Memory หลังทำงาน
   → งานหายหมด session หน้า

❌ อ่าน archive/ ทุกครั้ง
   → เปลือง token โดยไม่จำเป็น

❌ ถาม User ว่าจะ save ไหม
   → ต้องทำอัตโนมัติ!

❌ เขียน memory ยาวๆ verbose
   → ใช้ token เกินจำเป็น

❌ เก็บ sensitive data (API keys, passwords)
   → Security risk!
```

---

## ✅ Best Practices

```
✅ อ่าน 3 ไฟล์หลักพร้อมกัน (parallel read)
   → เร็ว + ประหยัด round trips

✅ Save memory ทุกครั้งที่ทำงานเสร็จ
   → ไม่มีงานหาย

✅ เขียนกระชับ ได้ใจความ
   → 1-2 บรรทัดต่อ item

✅ Archive เมื่อ active.md ยาวเกิน
   → รักษา token budget

✅ ใช้ภาษาเดียวกับ User
   → อ่านง่าย เข้าใจง่าย
```
